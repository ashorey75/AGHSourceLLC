{"ast":null,"code":"import{useState,useCallback,useEffect}from\"react\";let logoutTimer;export const useAuth=()=>{const[token,setToken]=useState(false);const[tokenExpirationDate,setTokenExpirationDate]=useState();const[userId,setUserId]=useState(null);const login=useCallback((uid,token,expirationDate)=>{setToken(token);setUserId(uid);const tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDate(tokenExpirationDate);localStorage.setItem(\"userData\",JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);const logout=useCallback(()=>{setToken(null);setTokenExpirationDate(null);setUserId(null);localStorage.removeItem(\"userData\");},[]);useEffect(()=>{const storedData=JSON.parse(localStorage.getItem(\"userData\"));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);useEffect(()=>{if(token&&tokenExpirationDate){const remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);return{token,login,logout,userId};};","map":{"version":3,"names":["useState","useCallback","useEffect","logoutTimer","useAuth","token","setToken","tokenExpirationDate","setTokenExpirationDate","userId","setUserId","login","uid","expirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","storedData","parse","getItem","remainingTime","setTimeout","clearTimeout"],"sources":["C:/Users/ashor/AGHSource/agh_frontend/src/shared/hooks/auth-hook.js"],"sourcesContent":["import { useState, useCallback, useEffect } from \"react\";\r\n\r\nlet logoutTimer;\r\n\r\nexport const useAuth = () => {\r\n  const [token, setToken] = useState(false);\r\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\r\n  const [userId, setUserId] = useState(null);\r\n\r\n  const login = useCallback((uid, token, expirationDate) => {\r\n    setToken(token);\r\n    setUserId(uid);\r\n    const tokenExpirationDate =\r\n      expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\r\n    setTokenExpirationDate(tokenExpirationDate);\r\n    localStorage.setItem(\r\n      \"userData\",\r\n      JSON.stringify({\r\n        userId: uid,\r\n        token: token,\r\n        expiration: tokenExpirationDate.toISOString(),\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    setTokenExpirationDate(null);\r\n    setUserId(null);\r\n    localStorage.removeItem(\"userData\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const storedData = JSON.parse(localStorage.getItem(\"userData\"));\r\n    if (\r\n      storedData &&\r\n      storedData.token &&\r\n      new Date(storedData.expiration) > new Date()\r\n    ) {\r\n      login(\r\n        storedData.userId,\r\n        storedData.token,\r\n        new Date(storedData.expiration)\r\n      );\r\n    }\r\n  }, [login]);\r\n\r\n  useEffect(() => {\r\n    if (token && tokenExpirationDate) {\r\n      const remainingTime =\r\n        tokenExpirationDate.getTime() - new Date().getTime();\r\n      logoutTimer = setTimeout(logout, remainingTime);\r\n    } else {\r\n      clearTimeout(logoutTimer);\r\n    }\r\n  }, [token, logout, tokenExpirationDate]);\r\n\r\n  return { token, login, logout, userId };\r\n};\r\n"],"mappings":"AAAA,OAASA,QAAQ,CAAEC,WAAW,CAAEC,SAAS,KAAQ,OAAO,CAExD,GAAI,CAAAC,WAAW,CAEf,MAAO,MAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGN,QAAQ,CAAC,KAAK,CAAC,CACzC,KAAM,CAACO,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGR,QAAQ,CAAC,CAAC,CAChE,KAAM,CAACS,MAAM,CAAEC,SAAS,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAE1C,KAAM,CAAAW,KAAK,CAAGV,WAAW,CAAC,CAACW,GAAG,CAAEP,KAAK,CAAEQ,cAAc,GAAK,CACxDP,QAAQ,CAACD,KAAK,CAAC,CACfK,SAAS,CAACE,GAAG,CAAC,CACd,KAAM,CAAAL,mBAAmB,CACvBM,cAAc,EAAI,GAAI,CAAAC,IAAI,CAAC,GAAI,CAAAA,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAAG,IAAI,CAAG,EAAE,CAAG,EAAE,CAAC,CACnEP,sBAAsB,CAACD,mBAAmB,CAAC,CAC3CS,YAAY,CAACC,OAAO,CAClB,UAAU,CACVC,IAAI,CAACC,SAAS,CAAC,CACbV,MAAM,CAAEG,GAAG,CACXP,KAAK,CAAEA,KAAK,CACZe,UAAU,CAAEb,mBAAmB,CAACc,WAAW,CAAC,CAC9C,CAAC,CACH,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,MAAM,CAAGrB,WAAW,CAAC,IAAM,CAC/BK,QAAQ,CAAC,IAAI,CAAC,CACdE,sBAAsB,CAAC,IAAI,CAAC,CAC5BE,SAAS,CAAC,IAAI,CAAC,CACfM,YAAY,CAACO,UAAU,CAAC,UAAU,CAAC,CACrC,CAAC,CAAE,EAAE,CAAC,CAENrB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsB,UAAU,CAAGN,IAAI,CAACO,KAAK,CAACT,YAAY,CAACU,OAAO,CAAC,UAAU,CAAC,CAAC,CAC/D,GACEF,UAAU,EACVA,UAAU,CAACnB,KAAK,EAChB,GAAI,CAAAS,IAAI,CAACU,UAAU,CAACJ,UAAU,CAAC,CAAG,GAAI,CAAAN,IAAI,CAAC,CAAC,CAC5C,CACAH,KAAK,CACHa,UAAU,CAACf,MAAM,CACjBe,UAAU,CAACnB,KAAK,CAChB,GAAI,CAAAS,IAAI,CAACU,UAAU,CAACJ,UAAU,CAChC,CAAC,CACH,CACF,CAAC,CAAE,CAACT,KAAK,CAAC,CAAC,CAEXT,SAAS,CAAC,IAAM,CACd,GAAIG,KAAK,EAAIE,mBAAmB,CAAE,CAChC,KAAM,CAAAoB,aAAa,CACjBpB,mBAAmB,CAACQ,OAAO,CAAC,CAAC,CAAG,GAAI,CAAAD,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CACtDZ,WAAW,CAAGyB,UAAU,CAACN,MAAM,CAAEK,aAAa,CAAC,CACjD,CAAC,IAAM,CACLE,YAAY,CAAC1B,WAAW,CAAC,CAC3B,CACF,CAAC,CAAE,CAACE,KAAK,CAAEiB,MAAM,CAAEf,mBAAmB,CAAC,CAAC,CAExC,MAAO,CAAEF,KAAK,CAAEM,KAAK,CAAEW,MAAM,CAAEb,MAAO,CAAC,CACzC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}